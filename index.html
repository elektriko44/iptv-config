<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>IPTV Final Test</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.9/shaka-player.compiled.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body style="margin:0;background:#000;color:#fff;font-family:Arial">

<div style="display:flex;height:100vh">
  <div id="list" style="width:320px;background:#111;overflow:auto;padding:10px"></div>
  <div id="player" style="flex:1;display:flex;align-items:center;justify-content:center"></div>
</div>

<script>
// ðŸ”¥ CRITICAL LINES NA NASA APP.JS MO
shaka.polyfill.installAll();
shaka.net.NetworkingEngine.registerScheme('https', shaka.net.HttpFetchPlugin);

const IPTV_TOKENS = {
  converge: "PASTE_TOKEN"
};

function withToken(u,k){
  return u + "?token=" + IPTV_TOKENS[k];
}
function hexToB64(hex){
  const b=new Uint8Array(hex.match(/.{1,2}/g).map(x=>parseInt(x,16)));
  return btoa(String.fromCharCode(...b));
}

const channels=[
{
  name:"RPTV",
  url:withToken("https://converse.nathcreqtives.com/1094/manifest.mpd","converge"),
  drm:true,
  keyId:"31363231383439313133323034313530",
  key:"78645370476a496d5756385231474332"
},
{
  name:"A2Z",
  url:"https://qp-pldt-live-bpk-02-prod.akamaized.net/bpk-tv/cg_a2z/default/index.mpd",
  drm:true,
  keyId:"f703e4c8ec9041eeb5028ab4248fa094",
  key:"c22f2162e176eee6273a5d0b68d19530"
},
{
  name:"Yes FM",
  url:"https://yesfmdagupan.radioca.st/",
  type:"mp3"
}
];

const list=document.getElementById('list');
channels.forEach(c=>{
  const d=document.createElement('div');
  d.innerText=c.name;
  d.style.padding="10px";
  d.style.cursor="pointer";
  d.onclick=()=>play(c);
  list.appendChild(d);
});

async function play(c){
  const box=document.getElementById('player');
  box.innerHTML="";

  if(c.type==="mp3"){
    const a=document.createElement('audio');
    a.controls=true;
    a.src=c.url;
    box.appendChild(a);
    a.play();
    return;
  }

  const v=document.createElement('video');
  v.controls=true;
  v.autoplay=true;
  box.appendChild(v);

  const p=new shaka.Player(v);

  if(c.drm){
    p.configure({
      drm:{clearKeys:{[hexToB64(c.keyId)]:hexToB64(c.key)}}
    });
  }

  await p.load(c.url);
}
</script>

</body>
</html>
